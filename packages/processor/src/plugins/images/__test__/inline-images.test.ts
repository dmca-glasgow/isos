import { expect, test } from 'vitest';

// @ts-ignore
import { pdfLatexFixtureToHtml } from '../../../test-utils/pdflatex-to-html';
import { unindentStringAndTrim } from '../../../test-utils/unindent-string';
import { testProcessor } from '../../../test-utils/unit-test-processor';

test('inline images', async () => {
  // const pdfLatexHtml = await pdfLatexFixtureToHtml.poppler(
  //   'images/article.tex',
  // );
  // console.log(pdfLatexHtml);

  // // TODO: neither poppler or mupdf will embed an PPF or SVG image here
  // // but it's in the pdflatex PDF
  // const expectedPdfLatexHtml = unindentStringAndTrim(`
  //   <img src="test-1_1.png"><br>
  //   <img src="test-1_2.jpg"><br>
  //   1
  // `);

  // expect(pdfLatexHtml).toBe(expectedPdfLatexHtml);

  const markdown = await testProcessor.fixture('images/article.tex', {
    noInlineImages: false,
  });
  // console.log(markdown);
  // return;

  const expectedMarkdown = unindentStringAndTrim(`
    ![My **SVG** caption](data\\:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxNC4zMjUgMTQuMzI1Ij48ZGVmcz48L2RlZnM+PGcgdHJhbnNmb3JtPSJtYXRyaXgoMSAwIDAgLTEgMCAxNC4zMjUpIj48ZyB0cmFuc2Zvcm09Im1hdHJpeCgxIDAgMCAtMSAwIDE0LjMyNSkiPjxwYXRoIGQ9Ik0gNy41IDAgQyAxMS42NDEgMCAxNC4zMjQgMy4zNTkgMTQuMzI0IDcuNSBDIDE0LjMyNCAxMS42NDEgMTEuNjQxIDE0LjMyNCA3LjUgMTQuMzI0IEMgMy4zNTkgMTQuMzI0IDAgMTEuNjQxIDAgNy41IEMgMCAzLjM1OSAzLjM1OSAwIDcuNSAwIFogTSA3LjUgMCIgZmlsbD0iI2ZmMDAwMCIgZmlsbC1vcGFjaXR5PSIxIj48L3BhdGg+PC9nPjwvZz48L3N2Zz4=){alt="My SVG alt text"}

    a

    ![My PNG caption](data\\:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDkuMS1jMDAyIDc5Ljc4Yjc2MzhlNiwgMjAyNS8wMi8xMS0yMzoxNDoxNCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDI2LjUgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MzBCMkNDRkQyMkIzMTFGMEEzNkM4MURBRkFEQjIxQ0YiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MzBCMkNDRkUyMkIzMTFGMEEzNkM4MURBRkFEQjIxQ0YiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDozMEIyQ0NGQjIyQjMxMUYwQTM2QzgxREFGQURCMjFDRiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDozMEIyQ0NGQzIyQjMxMUYwQTM2QzgxREFGQURCMjFDRiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PpaA3XYAAAAOSURBVHjaYvjPwAAQYAADAQEAZv2fJAAAAABJRU5ErkJggg==){alt="my PNG alt text"}

    b

    ![My JPEG caption](data\\:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAAAyAAD/4QMxaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA5LjEtYzAwMiA3OS43OGI3NjM4ZTYsIDIwMjUvMDIvMTEtMjM6MTQ6MTQgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCAyNi41IChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjlEQzhBMzk2MjJCMzExRjBBMzZDODFEQUZBREIyMUNGIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjlEQzhBMzk3MjJCMzExRjBBMzZDODFEQUZBREIyMUNGIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OURDOEEzOTQyMkIzMTFGMEEzNkM4MURBRkFEQjIxQ0YiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OURDOEEzOTUyMkIzMTFGMEEzNkM4MURBRkFEQjIxQ0YiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7/7gAOQWRvYmUAZMAAAAAB/9sAhAAIBgYGBgYIBgYIDAgHCAwOCggICg4QDQ0ODQ0QEQwODQ0ODBEPEhMUExIPGBgaGhgYIyIiIiMnJycnJycnJycnAQkICAkKCQsJCQsOCw0LDhEODg4OERMNDQ4NDRMYEQ8PDw8RGBYXFBQUFxYaGhgYGhohISAhIScnJycnJycnJyf/wAARCAABAAEDASIAAhEBAxEB/8QATAABAQAAAAAAAAAAAAAAAAAAAAYBAQEAAAAAAAAAAAAAAAAAAAYHEAEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwCLAGVxf//Z){alt="my JPEG alt text"}

    c

    ![My **caption** text](data\\:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDkuMS1jMDAyIDc5Ljc4Yjc2MzhlNiwgMjAyNS8wMi8xMS0yMzoxNDoxNCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDI2LjUgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MzBCMkNDRkQyMkIzMTFGMEEzNkM4MURBRkFEQjIxQ0YiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MzBCMkNDRkUyMkIzMTFGMEEzNkM4MURBRkFEQjIxQ0YiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDozMEIyQ0NGQjIyQjMxMUYwQTM2QzgxREFGQURCMjFDRiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDozMEIyQ0NGQzIyQjMxMUYwQTM2QzgxREFGQURCMjFDRiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PpaA3XYAAAAOSURBVHjaYvjPwAAQYAADAQEAZv2fJAAAAABJRU5ErkJggg==){#fig-logo alt="My alt text"}

    Refer to @fig-logo.
  `);

  expect(markdown).toBe(expectedMarkdown);
  return;

  const html = await testProcessor.md(markdown);
  // console.log(html);

  const expectedHtml = unindentStringAndTrim(`
    <figure><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxNC4zMjUgMTQuMzI1Ij48ZGVmcz48L2RlZnM+PGcgdHJhbnNmb3JtPSJtYXRyaXgoMSAwIDAgLTEgMCAxNC4zMjUpIj48ZyB0cmFuc2Zvcm09Im1hdHJpeCgxIDAgMCAtMSAwIDE0LjMyNSkiPjxwYXRoIGQ9Ik0gNy41IDAgQyAxMS42NDEgMCAxNC4zMjQgMy4zNTkgMTQuMzI0IDcuNSBDIDE0LjMyNCAxMS42NDEgMTEuNjQxIDE0LjMyNCA3LjUgMTQuMzI0IEMgMy4zNTkgMTQuMzI0IDAgMTEuNjQxIDAgNy41IEMgMCAzLjM1OSAzLjM1OSAwIDcuNSAwIFogTSA3LjUgMCIgZmlsbD0iI2ZmMDAwMCIgZmlsbC1vcGFjaXR5PSIxIj48L3BhdGg+PC9nPjwvZz48L3N2Zz4=" alt="My SVG alt text" />
      <figcaption><strong>Figure 1:</strong> My <strong>SVG</strong> caption</figcaption>
    </figure>
    <p>a</p>
    <figure><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDkuMS1jMDAyIDc5Ljc4Yjc2MzhlNiwgMjAyNS8wMi8xMS0yMzoxNDoxNCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDI2LjUgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MzBCMkNDRkQyMkIzMTFGMEEzNkM4MURBRkFEQjIxQ0YiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MzBCMkNDRkUyMkIzMTFGMEEzNkM4MURBRkFEQjIxQ0YiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDozMEIyQ0NGQjIyQjMxMUYwQTM2QzgxREFGQURCMjFDRiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDozMEIyQ0NGQzIyQjMxMUYwQTM2QzgxREFGQURCMjFDRiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PpaA3XYAAAAOSURBVHjaYvjPwAAQYAADAQEAZv2fJAAAAABJRU5ErkJggg==" alt="my PNG alt text" />
      <figcaption><strong>Figure 2:</strong> My PNG caption</figcaption>
    </figure>
    <p>b</p>
    <figure><img src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAAAyAAD/4QMxaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA5LjEtYzAwMiA3OS43OGI3NjM4ZTYsIDIwMjUvMDIvMTEtMjM6MTQ6MTQgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCAyNi41IChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjlEQzhBMzk2MjJCMzExRjBBMzZDODFEQUZBREIyMUNGIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjlEQzhBMzk3MjJCMzExRjBBMzZDODFEQUZBREIyMUNGIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OURDOEEzOTQyMkIzMTFGMEEzNkM4MURBRkFEQjIxQ0YiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OURDOEEzOTUyMkIzMTFGMEEzNkM4MURBRkFEQjIxQ0YiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7/7gAOQWRvYmUAZMAAAAAB/9sAhAAIBgYGBgYIBgYIDAgHCAwOCggICg4QDQ0ODQ0QEQwODQ0ODBEPEhMUExIPGBgaGhgYIyIiIiMnJycnJycnJycnAQkICAkKCQsJCQsOCw0LDhEODg4OERMNDQ4NDRMYEQ8PDw8RGBYXFBQUFxYaGhgYGhohISAhIScnJycnJycnJyf/wAARCAABAAEDASIAAhEBAxEB/8QATAABAQAAAAAAAAAAAAAAAAAAAAYBAQEAAAAAAAAAAAAAAAAAAAYHEAEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwCLAGVxf//Z" alt="my JPEG alt text" />
      <figcaption><strong>Figure 3:</strong> My JPEG caption</figcaption>
    </figure>
  `);

  expect(html).toBe(expectedHtml);
});
